"""
–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è AI-–ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤
–ü—Ä–æ–µ–∫—Ç "–í—Ç–æ—Ä–æ–π –º–æ–∑–≥" - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–æ–ª–æ—Å–æ–≤–æ–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç
"""

import asyncio
import sys
from pathlib import Path

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
sys.path.append(str(Path(__file__).parent))

from smart_search import SmartSearchEngine
from database import DatabaseManager

async def demo_parsing_comparison():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º —Ä–∞–∑–Ω–∏—Ü—É –º–µ–∂–¥—É –æ–±—ã—á–Ω—ã–º –∏ AI-–ø–∞—Ä—Å–∏–Ω–≥–æ–º"""
    print("üîç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ –∑–∞–ø—Ä–æ—Å–æ–≤")
    print("=" * 50)
    
    # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –¥–≤–∏–∂–∫–∏
    db = DatabaseManager("mira_brain.db")
    
    # –û–±—ã—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥ (–±–µ–∑ AI)
    search_engine_old = SmartSearchEngine(db)
    
    # AI-–ø–∞—Ä—Å–∏–Ω–≥ (—Å fallback)
    search_engine_ai = SmartSearchEngine(db, "test-key")  # –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback
    
    # –°–ª–æ–∂–Ω—ã–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã
    test_queries = [
        {
            "query": "—Ä–∞—Å—Å–∫–∞–∂–∏ –æ –í–∞—Å–µ",
            "description": "–ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å –æ —á–µ–ª–æ–≤–µ–∫–µ"
        },
        {
            "query": "—á—Ç–æ —Å –∞–≤—Ç–æ–º–æ–±–∏–ª–µ–º",
            "description": "–ó–∞–ø—Ä–æ—Å —Å —Å–∏–Ω–æ–Ω–∏–º–æ–º (–∞–≤—Ç–æ–º–æ–±–∏–ª—å = –º–∞—à–∏–Ω–∞)"
        },
        {
            "query": "–ø–æ–∫–∞–∂–∏ –∞–≤—Ç–æ",
            "description": "–°–æ–∫—Ä–∞—â–µ–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ (–∞–≤—Ç–æ = –∞–≤—Ç–æ–º–æ–±–∏–ª—å)"
        },
        {
            "query": "—á—Ç–æ –∑–Ω–∞–µ—à—å –æ —Ä–∞–±–æ—Ç–µ –∏ –∫–∞—Ä—å–µ—Ä–µ",
            "description": "–ó–∞–ø—Ä–æ—Å —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ (—Ä–∞–±–æ—Ç–∞ = –∫–∞—Ä—å–µ—Ä–∞)"
        },
        {
            "query": "—Ä–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –∑–¥–æ—Ä–æ–≤—å–µ –∏ –º–µ–¥–∏—Ü–∏–Ω—É",
            "description": "–ó–∞–ø—Ä–æ—Å —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ (–∑–¥–æ—Ä–æ–≤—å–µ = –º–µ–¥–∏—Ü–∏–Ω–∞)"
        },
        {
            "query": "–ø–æ–∫–∞–∂–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∏ –¥–µ–¥–ª–∞–π–Ω—ã",
            "description": "–ó–∞–ø—Ä–æ—Å —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ (–Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è = –¥–µ–¥–ª–∞–π–Ω—ã)"
        },
        {
            "query": "—á—Ç–æ-—Ç–æ —Å —Ñ–∏–Ω–∞–Ω—Å–∞–º–∏ –∏ –¥–µ–Ω—å–≥–∞–º–∏",
            "description": "–ó–∞–ø—Ä–æ—Å —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ (—Ñ–∏–Ω–∞–Ω—Å—ã = –¥–µ–Ω—å–≥–∏)"
        }
    ]
    
    for i, test_case in enumerate(test_queries, 1):
        query = test_case["query"]
        description = test_case["description"]
        
        print(f"\n{i}. {description}")
        print(f"üìù –ó–∞–ø—Ä–æ—Å: '{query}'")
        print("-" * 40)
        
        # –û–±—ã—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥
        old_result = search_engine_old.parse_query(query)
        print("üîß –û–±—ã—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥:")
        for entity_type, terms in old_result.items():
            if terms:
                print(f"  {entity_type}: {', '.join(terms)}")
        
        # AI-–ø–∞—Ä—Å–∏–Ω–≥ (fallback)
        ai_result = await search_engine_ai.parse_query_ai(query)
        print("ü§ñ AI-–ø–∞—Ä—Å–∏–Ω–≥ (fallback):")
        for entity_type, terms in ai_result.items():
            if terms:
                print(f"  {entity_type}: {', '.join(terms)}")
        
        # –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–ª–∏—á–∏–π
        print("üìä –ê–Ω–∞–ª–∏–∑:")
        old_terms = set()
        ai_terms = set()
        
        for terms in old_result.values():
            old_terms.update(terms)
        for terms in ai_result.values():
            ai_terms.update(terms)
        
        common = old_terms & ai_terms
        old_only = old_terms - ai_terms
        ai_only = ai_terms - old_terms
        
        if common:
            print(f"  ‚úÖ –û–±—â–∏–µ —Ç–µ—Ä–º–∏–Ω—ã: {', '.join(common)}")
        if old_only:
            print(f"  üîß –¢–æ–ª—å–∫–æ –≤ –æ–±—ã—á–Ω–æ–º: {', '.join(old_only)}")
        if ai_only:
            print(f"  ü§ñ –¢–æ–ª—å–∫–æ –≤ AI: {', '.join(ai_only)}")

def demonstrate_limitations():
    """–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–±—ã—á–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞"""
    print("\n\nüö´ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –æ–±—ã—á–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞")
    print("=" * 50)
    
    limitations = [
        {
            "problem": "–ù–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è —Å–∏–Ω–æ–Ω–∏–º–æ–≤",
            "example": "–∞–≤—Ç–æ ‚â† –º–∞—à–∏–Ω–∞ ‚â† –∞–≤—Ç–æ–º–æ–±–∏–ª—å",
            "impact": "–ü–æ–∏—Å–∫ –Ω–µ –Ω–∞–π–¥–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏"
        },
        {
            "problem": "–†—É—á–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è",
            "example": "–≤–∞—Å–µ ‚Üí –≤–∞—Å—è (—Ç–æ–ª—å–∫–æ –≤ —Å–ª–æ–≤–∞—Ä–µ)",
            "impact": "–ù–æ–≤—ã–µ —Å–ª–æ–≤–∞ –Ω–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è"
        },
        {
            "problem": "–ù–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞",
            "example": "—Ä–∞–±–æ—Ç–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–µ—Å—Ç–æ –∏–ª–∏ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
            "impact": "–ù–µ—Ç–æ—á–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è"
        },
        {
            "problem": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã",
            "example": "—á—Ç–æ —Å –í–∞—Å–µ–π ‚â† —Ä–∞—Å—Å–∫–∞–∂–∏ –æ –í–∞—Å–µ",
            "impact": "–ú–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞—é—Ç—Å—è"
        },
        {
            "problem": "–ù–µ—Ç –ø–æ–Ω–∏–º–∞–Ω–∏—è –Ω–∞–º–µ—Ä–µ–Ω–∏–π",
            "example": "–ø–æ–∫–∞–∂–∏ ‚â† —Ä–∞—Å—Å–∫–∞–∂–∏ ‚â† —á—Ç–æ –∑–Ω–∞–µ—à—å",
            "impact": "–û–¥–∏–Ω–∞–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π"
        }
    ]
    
    for i, limitation in enumerate(limitations, 1):
        print(f"\n{i}. {limitation['problem']}")
        print(f"   üìù –ü—Ä–∏–º–µ—Ä: {limitation['example']}")
        print(f"   ‚ö†Ô∏è  –ü—Ä–æ–±–ª–µ–º–∞: {limitation['impact']}")

def show_ai_advantages():
    """–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ AI-–ø–∞—Ä—Å–∏–Ω–≥–∞"""
    print("\n\n‚ú® –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ AI-–ø–∞—Ä—Å–∏–Ω–≥–∞")
    print("=" * 50)
    
    advantages = [
        {
            "feature": "–ü–æ–Ω–∏–º–∞–Ω–∏–µ —Å–∏–Ω–æ–Ω–∏–º–æ–≤",
            "example": "–∞–≤—Ç–æ, –º–∞—à–∏–Ω–∞, –∞–≤—Ç–æ–º–æ–±–∏–ª—å ‚Üí object",
            "benefit": "–ù–∞—Ö–æ–¥–∏—Ç –≤—Å–µ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å–∏"
        },
        {
            "feature": "–£–º–Ω–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è",
            "example": "–≤–∞—Å–µ, –≤–∞—Å—é, –≤–∞—Å–∏ ‚Üí –≤–∞—Å—è",
            "benefit": "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ª—é–±—ã—Ö —Å–ª–æ–≤"
        },
        {
            "feature": "–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑",
            "example": "—Ä–∞–±–æ—Ç–∞ –≤ –æ—Ñ–∏—Å–µ vs —Ä–∞–±–æ—Ç–∞ –Ω–∞–¥ –ø—Ä–æ–µ–∫—Ç–æ–º",
            "benefit": "–¢–æ—á–Ω–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∑–∞—Ü–∏—è –ø–æ –∫–æ–Ω—Ç–µ–∫—Å—Ç—É"
        },
        {
            "feature": "–ü–æ–Ω–∏–º–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π",
            "example": "–ø–æ–∫–∞–∂–∏, —Ä–∞—Å—Å–∫–∞–∂–∏, —á—Ç–æ –∑–Ω–∞–µ—à—å ‚Üí search",
            "benefit": "–†–∞–∑–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–Ω—ã—Ö –Ω–∞–º–µ—Ä–µ–Ω–∏–π"
        },
        {
            "feature": "–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫",
            "example": "—á—Ç–æ —Å –í–∞—Å–µ–π = —Ä–∞—Å—Å–∫–∞–∂–∏ –æ –í–∞—Å–µ",
            "benefit": "–ü–æ–Ω–∏–º–∞–µ—Ç —Å–º—ã—Å–ª, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ —Å–ª–æ–≤–∞"
        }
    ]
    
    for i, advantage in enumerate(advantages, 1):
        print(f"\n{i}. {advantage['feature']}")
        print(f"   üìù –ü—Ä–∏–º–µ—Ä: {advantage['example']}")
        print(f"   ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ: {advantage['benefit']}")

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏"""
    print("üöÄ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è AI-–ø–∞—Ä—Å–∏–Ω–≥–∞ –¥–ª—è —É–º–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞")
    print("=" * 60)
    
    # –î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ–º —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–∞—Ä—Å–∏–Ω–≥–∞
    await demo_parsing_comparison()
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    demonstrate_limitations()
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ AI
    show_ai_advantages()
    
    print("\n\nüéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ")
    print("=" * 30)
    print("AI-–ø–∞—Ä—Å–∏–Ω–≥ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –ø–æ–∏—Å–∫–∞:")
    print("‚Ä¢ –ü–æ–Ω–∏–º–∞–µ—Ç —Å–∏–Ω–æ–Ω–∏–º—ã –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç")
    print("‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Å–ª–æ–≤–∞")
    print("‚Ä¢ –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –Ω–∞–º–µ—Ä–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è")
    print("‚Ä¢ –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–∏—Å–∫")
    print("‚Ä¢ –ò–º–µ–µ—Ç fallback –Ω–∞ –æ–±—ã—á–Ω—ã–π –ø–∞—Ä—Å–∏–Ω–≥")
    
    print("\nüí° –î–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω—É–∂–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π DEEPSEEK_API_KEY")

if __name__ == "__main__":
    asyncio.run(main())
